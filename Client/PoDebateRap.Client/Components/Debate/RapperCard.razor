@using PoDebateRap.Shared.Models
@inject IJSRuntime JS

<div class="rapper-card @GetCardClass()" @onclick="HandleClick">
    <div class="card-selection-indicator">
        @if (IsSelected)
        {
            <span class="checkmark">âœ“</span>
        }
    </div>
    
    <div class="rapper-avatar">
        @GetRapperInitial()
    </div>
    
    <div class="rapper-card-info">
        <h5 class="rapper-card-name">@Rapper.Name</h5>
        
        @if (Rapper.TotalDebates > 0)
        {
            <div class="rapper-card-stats">
                <span class="stat-item win">@Rapper.Wins W</span>
                <span class="stat-divider">-</span>
                <span class="stat-item loss">@Rapper.Losses L</span>
            </div>
            <div class="rapper-card-winrate">
                @GetWinRate()% Win Rate
            </div>
        }
        else
        {
            <div class="rapper-card-stats">
                <span class="stat-item undefeated">Undefeated</span>
            </div>
        }
    </div>
    
    @if (IsSelected)
    {
        <div class="selection-badge">
            @SelectionLabel
        </div>
    }
</div>

@code {
    [Parameter] public Rapper Rapper { get; set; } = new();
    [Parameter] public bool IsSelected { get; set; }
    [Parameter] public bool IsDisabled { get; set; }
    [Parameter] public string SelectionLabel { get; set; } = "Selected";
    [Parameter] public EventCallback<Rapper> OnSelect { get; set; }

    private async Task HandleClick()
    {
        if (!IsDisabled)
        {
            // Trigger haptic feedback
            try
            {
                await JS.InvokeVoidAsync("haptic.light");
            }
            catch { /* Haptic not supported */ }
            
            await OnSelect.InvokeAsync(Rapper);
        }
    }

    private string GetCardClass()
    {
        var classes = new List<string>();
        
        if (IsSelected)
            classes.Add("selected");
        
        if (IsDisabled)
            classes.Add("disabled");
        
        return string.Join(" ", classes);
    }

    private string GetRapperInitial()
    {
        if (string.IsNullOrEmpty(Rapper.Name))
            return "?";
        
        return Rapper.Name.Substring(0, 1).ToUpper();
    }

    private int GetWinRate()
    {
        if (Rapper.TotalDebates == 0) return 0;
        return (int)Math.Round((double)Rapper.Wins / Rapper.TotalDebates * 100);
    }
}
